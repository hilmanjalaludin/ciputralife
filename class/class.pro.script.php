<?php	require("../sisipan/sessions.php");	require("../fungsi/global.php");	require("../class/MYSQLConnect.php");		/*	 *	class untuk action call result	 *  author : omens	 *  date : 2012-10-17	*/				class ProPrefix extends mysql{		var $action;				function __construct(){			parent::__construct();			$this->action = $this->escPost('action');				}			/* function set style css **/		function setCss(){?>						<!-- start: css -->				<style>					.select { border:1px solid #dddddd;width:160px;font-size:11px;height:22px;background-color:#fffccc;}					.input_text {border:1px solid #dddddd;width:160px;font-size:12px;height:20px;background-color:#fffccc;}					.text_header { text-align:right;color:red;}					.select_multiple { border:1px solid #dddddd;width:250px;font-size:11px;background-color:#fffccc;}				</style>							<!-- stop: css -->		<?php }						function initClass(){			if( $this->havepost('action')):				switch( $this->action){					case 'tpl_add'  : $this->tplResultAdd();    break;					case 'tpl_edit' : $this->tplResultEdit();   break;					case 'tpl_delete': $this->tplResultRemove(); break;					case 'save_prefix': $this -> saveResult(); break;					case 'delete_result' : $this -> deleteResult(); break;					case 'enable_prefix' : $this -> enablePrefix(); break;					case 'disable_prefix' : $this -> disablePrefix(); break;						case 'upload_script'  : $this -> UploadScript(); break;				}			endif;		}				function UploadScript(){			$typeUpload = explode('.', $_REQUEST['act_file_name']);			$post_pdf = (INT)(count($typeUpload)-1);						if( $this -> havepost('act_file_name'))			{				//echo strtolower($typeUpload[$post_pdf])."<br>";				if( strtolower($typeUpload[$post_pdf])=='pdf')				{					if( !copy($_FILES['fileToupload']['tmp_name'], '../script/'.$_FILES['fileToupload']['name']) ){						echo 'Error, Failed Copy !';										}else{							$datas = array(									'ProductId'=> $_REQUEST['product_id'], 									'ScriptFileName'=> $_REQUEST['act_file_name'],									'ScriptFlagStatus'=> 1,									'ScriptUpload'=> $_REQUEST['script_init_name'],									'UploadDate'=> date('Y-m-d H:i:s'),									'UploadBy'=> $this -> getSession('UserId')									);																$query = $this -> set_mysql_insert('t_gn_productscript',$datas);							if( $query ):								echo 'Success, File Upload Success !';							else :								echo 'Error, Failed to Upload !';							endif;					}				}				else					echo 'Error, File must by PDF file !';			}		}								function enablePrefix(){			$sql = " update t_gn_productscript  SET ScriptFlagStatus=1 					 where ScriptId ='".$this -> escPost('resultid')."'"; 					 			$qry = $this ->execute($sql,__FILE__,__LINE__);						if ( $qry ) : echo 1;			else : 				echo 0; 			endif;		}				function disablePrefix(){			$sql = " update t_gn_productscript   SET ScriptFlagStatus=0 					 where ScriptId ='".$this -> escPost('resultid')."'"; 					 			$qry = $this ->execute($sql,__FILE__,__LINE__);						if ( $qry ) : echo 1;			else : 				echo 0; 			endif;		}					/* delete **/		function deleteResult(){			$sql = " delete from t_gn_productscript where ScriptId ='".$this -> escPost('resultid')."'"; 			$qry = $this ->execute($sql,__FILE__,__LINE__);						if ( $qry ) : echo 1;			else : 				echo 0; 			endif;		}			function genProductPrefix(){			$number = '';						$maxLength  = $_REQUEST['prefix_prefix'];			$maxLength  = (($_REQUEST['prefix_prefix']) -strlen($_REQUEST['prefix_code']));			for( $i=1; $i<=$maxLength; $i++){				$number.='0';							}			return strtoupper($this -> escPost('prefix_code').trim($number));				}					/* save */				function saveResult(){					$prefix = array(				'ProductId'=> $this -> escPost('prefix_head'), 				'PrefixChar'=> $this -> genProductPrefix(), 				'PrefixLength'=> $this -> escPost('prefix_name'), 				'PrefixFlagStatus'=> $this -> escPost('prefix_status')				);										$query = $this -> set_mysql_insert('t_gn_productprefixnumber',$prefix);				if( $query ) : echo 1;				else :					echo 0;				endif;						}			/** function getCategory **/				private function getProduct(){ ?>			<select class="select" id="product_id" name="product_id"  style="width:auto;">				<option value="">-- Choose --</option>				<?php					$sql = "select a.ProductId, a.ProductCode, a.ProductCode 							from t_gn_product a where a.ProductStatusFlag=1";					$qry = $this -> execute($sql,__FILE__,__LINE__);												while( $row = $this -> fetcharray($qry)){							echo "<option value=\"{$row[0]}\">{$row[1]} - {$row[2]}</option>";						}									?>			</select>		<?php }					/** function getCategory **/				private function getCategory(){ ?>			<select class="select" id="status_active" name="status_active">				<option value="">-- Choose --</option>				<?php									$status  = array(0=>'Not Active', 1=>'Active');											foreach( $status as $key=>$value){							echo "<option value=\"{$key}\">{$value}</option>";						}								?>			</select>		<?php }		/** function getCategory **/				private function getActivated(){ ?>			<select class="select">				<option value="">-- Choose --</option>			</select>		<?php }									function tplResultAdd(){ 				$this->setCss();				?>			<div id="result_content_add" class="box-shadow" style="margin-top:10px;">				<h3 class="box-shadow h3"> Add Product Script </h3>				<table border="0" cellpadding="8px" align="cnter">					<tr>						<th nowrap class="text_header">* File Name </th>						<td><?php $this -> DBForm -> upload(); ?></td>						<td rowspan="4">							<span id="loadings_gambar"  style="display:none;color:red;"> <img src="../gambar/loading.gif"> loading...</span>						</td>					</tr>					<tr>					<tr>						<td class="text_header">* Product </td>						<td><?php $this -> getProduct(); ?></td>					</tr>					<tr>						<td class="text_header">* Script Title </td>						<td>							<input type="text" name="script_init_name" id="script_init_name" class="input_text" style="padding-right:2px;width:300px;height:18px;text-align:left;">						</td>					</tr>										<tr>						<th nowrap>											    </th>						<td>							<a href="javascript:void(0);" class="sbutton" onclick="proses();"><span>&nbsp;Prosess</span></a>						</td>					</tr>														</table>			</div>		<?php		}				function tplResultEdit(){ 			$this->setCss(); 			?>			<div id="result_content_add" class="box-shadow" style="margin-top:10px;">				<h3 class="box-shadow h3"> Edit Product Prefix </h3>				<table cellpadding="6px;">					<tr>						<td class="text_header">* Product </td>						<td><?php $this -> getProduct(); ?></td>					</tr>					<tr>						<td class="text_header">* Prefix Code</td>						<td>							<input type="text" name="result_code" id="result_code" class="input_text" style="padding-right:2px;width:60px;height:18px;text-align:center;" maxlength="2">						</td>					</tr>										<tr>						<td class="text_header">* Prefix Length</td>						<td>							<input type="text" name="result_name" id="result_name" class="input_text" style="width:60px;height:18px;text-align:center;"> 						</td>					</tr>										<tr>						<td class="text_header">Status</td>						<td><?php $this->getCategory(); ?></td>					</tr>										<tr>						<td class="text_header">&nbsp;</td>						<td><a href="javascript:void(0);" class="sbutton" onclick="savePrefix();"><span>&nbsp;Save</span></a></td>					</tr>				</table>			</div>		<?php		}				function tplResultRemove(){ ?>			<div id="result_content_delete" class="box-shadow" style="margin-top:10px;">							</div>		<?php		}	}		$ProPrefix= new ProPrefix();	$ProPrefix -> initClass();
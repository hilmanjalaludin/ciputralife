<?php	require(dirname(__FILE__)."/../sisipan/sessions.php");	require(dirname(__FILE__)."/../fungsi/global.php");	require(dirname(__FILE__)."/../class/MYSQLConnect.php");		require(dirname(__FILE__)."/../plugin/lib.form.php");	/*	 *	class untuk action  reload data	 *  author : omens	 *  date : 2012-10-17	*/		class ProductPlan extends mysql{		var $action;		var $product;		var $JP_Plugin;				function __construct()		{			parent::__construct();						$this -> JP_Plugin = new jpForm(true);			if( $this -> havepost('action'))			{				$this -> action = $this ->escPost('action');				$this -> product= $this ->escPost('product');			}		}				function index()		{			switch($this -> action)			{				case 'get_list_product'  : $this -> getListProduct(); break;				case 'get_list_group' 	 : $this -> getListGroup(); break;				case 'get_list_paymode'  : $this -> getListPaymode(); break;				case 'get_list_plan' 	 : $this -> getListPlan(); break;				case 'view_edit_content' : $this -> getListContent(); break;				case 'get_list_age'		 : $this -> getListAge(); break;				case 'update_premi'		 : $this -> UpdatePremi(); break;				case 'enable_product'	 : $this -> EnableProduct(); break;				case 'disable_product'	 : $this -> DisableProduct(); break;			}		}				function EnableProduct()		{			$sql = "UPDATE t_gn_product SET ProductStatusFlag = 1 where ProductId = '".$this -> product."'";			$qry = $this ->execute($sql,__FILE__,__LINE__);									if ( $qry ) : echo 1;			else : 				echo 0; 			endif;		}				function DisableProduct()		{			$sql = "UPDATE t_gn_product SET ProductStatusFlag = 0 where ProductId = '".$this -> product."'";			$qry = $this ->execute($sql,__FILE__,__LINE__);									if ( $qry ) : echo 1;			else : 				echo 0; 			endif;		}				function UpdatePremi()		{			$sql = "UPDATE t_gn_productplan SET ProductPlanPremium='".$_REQUEST['newpremi']."' where ProductPlanId='".$_REQUEST['planId']."'";			$q= $this ->execute($sql,__FILE__,__LINE__);				if( $q ) echo 1;				else echo 0;						}				function getListContent()		{			$start_age = $this -> explodeAge();			$sql = " select b.ProductCode,					a.ProductPlanId,					b.ProductName,					c.PremiumGroupDesc,					d.PayMode, 					a.ProductPlanName,					a.ProductPlanAgeStart,					a.ProductPlanAgeEnd,					a.ProductPlanPremium				from t_gn_productplan a						left join t_gn_product b on a.ProductId=b.ProductId						left join t_lk_premiumgroup c on a.PremiumGroupId=c.PremiumGroupId						left join t_lk_paymode d on a.PayModeId=d.PayModeId						where 1=1						And a.ProductId='".$_REQUEST['product_id']."'						and a.PayModeId='".$_REQUEST['paymode_id']."'						and a.PremiumGroupId='".$_REQUEST['grooup_id']."'						and a.ProductPlan='".$_REQUEST['planid']."'						and a.ProductPlanAgeStart ='".$start_age['start']."'						and a.ProductPlanAgeEnd ='".$start_age['end']."'";						$qry = $this -> query($sql);			if( !$qry -> EOF() )			{				$row = $qry -> result_first_assoc(); ?>				<fieldset>					<legend> Edit Premium Group </legend>				<div class="box-shadow" style="margin-bottom:5px;">					<table cellpadding="8px;" cellspacing="0">						<tr>							<td style="border-right:1px solid #bbb000;background-color:#eeeeee;color:red;font-weight:bold;font-size:12px;">Product</td>							<td style="border-right:1px solid #bbb000;background-color:#eeeeee;color:red;font-weight:bold;font-size:12px;">Premium Group</td>							<td style="border-right:1px solid #bbb000;background-color:#eeeeee;color:red;font-weight:bold;font-size:12px;">PayMode</td>							<td style="border-right:1px solid #bbb000;background-color:#eeeeee;color:red;font-weight:bold;font-size:12px;">Product Plan</td>							<td style="border-right:1px solid #bbb000;background-color:#eeeeee;color:red;font-weight:bold;font-size:12px;">Start Age</td>							<td style="border-right:1px solid #bbb000;background-color:#eeeeee;color:red;font-weight:bold;font-size:12px;">End Age</td>							<td style="border-right:1px solid #bbb000;background-color:#eeeeee;color:red;font-weight:bold;font-size:12px;">Old Premium Value</td>													</tr>						<tr>							<td style="border-top:1px solid #bbb000;border-right:1px solid #bbb000;background-color:#ffffff;color:blue;font-weight:normal;font-size:12px;"><?php echo $row['ProductName'];?></td>							<td style="border-top:1px solid #bbb000;border-right:1px solid #bbb000;background-color:#ffffff;color:blue;font-weight:normal;font-size:12px;"><?php echo $row['PremiumGroupDesc'];?></td>							<td style="border-top:1px solid #bbb000;border-right:1px solid #bbb000;background-color:#ffffff;color:blue;font-weight:normal;font-size:12px;"><?php echo $row['PayMode'];?></td>							<td style="border-top:1px solid #bbb000;border-right:1px solid #bbb000;background-color:#ffffff;color:blue;font-weight:normal;font-size:12px;"><?php echo $row['ProductPlanName'];?></td>							<td style="border-top:1px solid #bbb000;border-right:1px solid #bbb000;background-color:#ffffff;color:blue;font-weight:normal;font-size:12px;"><?php echo $row['ProductPlanAgeStart'];?></td>							<td style="border-top:1px solid #bbb000;border-right:1px solid #bbb000;background-color:#ffffff;color:blue;font-weight:normal;font-size:12px;"><?php echo $row['ProductPlanAgeEnd'];?></td>							<td style="border-top:1px solid #bbb000;border-right:1px solid #bbb000;background-color:#ffffff;color:blue;font-weight:normal;font-size:12px;"><?php echo $row['ProductPlanPremium'];?></td>													</tr>												<tr>							<td style="border-top:1px solid #bbb000;border-right:0px solid #bbb000;background-color:#ffffff;color:black;font-weight:normal;font-size:12px;" nowrap>New Premi</td>							<td style="border-top:1px solid #bbb000;border-right:0px solid #bbb000;background-color:#ffffff;color:blue;font-weight:normal;font-size:12px;" colspan="2">								<input type="text" name="new_premium_value" id="new_premium_value" style="border:1px solid #dddddd;height:24px;">							</td>							<td style="border-top:1px solid #bbb000;border-right:0px solid #bbb000;background-color:#ffffff;color:blue;font-weight:normal;font-size:12px;" colspan="8">														<a href="javascript:void(0);" class="sbutton" onclick="updatePremi('<?php echo $row['ProductPlanId']; ?>')" ><span>&nbsp;Update</span>														</td>						</tr>					</table>						</div>						</fieldset>				<?php			}			else{				echo "Not Found Premi!";			}		}			/** get array product ***/			function getProduct()		{			$sql =" select a.ProductId, a.ProductCode, a.ProductName from t_gn_product a where a.ProductStatusFlag=1 ";			$qry = $this -> query($sql);			foreach( $qry -> result_assoc() as $rows )			{				$datas[$rows['ProductId']] = $rows['ProductName'];			}						return $datas;		}		 /* explode data **/			function explodeAge()		{			$ageString = explode("_",$_REQUEST['ageid']);			$datas['start']  = $ageString[0];			$datas['end']  = $ageString[1];			return $datas;		}		/** get list group premium ***/			function getListGroup()		{			$sql =" select * from t_lk_premiumgroup a where a.PremiumGroupId<>4 ";			$qry = $this -> query($sql);			foreach( $qry -> result_array() as $rows )			{				$datas[$rows[0]] = $rows[2];			}						return $datas;		}		/** get list paymode ***/				function getListPaymode()		{			$sql =" select * from t_lk_paymode a   ";			$qry = $this -> query($sql);			foreach( $qry -> result_array() as $rows )			{				$datas[$rows[0]] = $rows[1];			}						return $datas;		}				/* get list of plan ****/				function getListPlan()		{			$sql =" select a.ProductPlan, a.ProductPlanName from t_gn_productplan a where a.ProductId='".$_REQUEST['productid']."' group by a.ProductPlan";			$qry = $this -> query($sql);			foreach( $qry -> result_assoc() as $rows )			{				$datas[$rows['ProductPlan']] = $rows['ProductPlanName'];			}			$this -> JP_Plugin-> jpCombo('filter_plan_id',NULL,$datas,NULL,NULL);					}		/* get list of getListAge ****/		function getListAge()		{			$sql =" select a.ProductPlanAgeStart, a.ProductPlanAgeEnd from t_gn_productplan a where a.ProductId='".$_REQUEST['productid']."' group by a.ProductPlanAgeStart ";			$qry = $this -> query($sql);			foreach( $qry -> result_assoc() as $rows )			{				$concatKeys  = $rows['ProductPlanAgeStart']."_".$rows['ProductPlanAgeEnd']; 				$concatValue = $rows['ProductPlanAgeStart']."-".$rows['ProductPlanAgeEnd'];				if( !empty($concatKeys))				{					$datas[$concatKeys] = $concatValue;				}			}						$this -> JP_Plugin-> jpCombo('filter_age_id',NULL,$datas,NULL,NULL);					}						function getListProduct(){			?>				<style>					select { width:200px; border:1px solid #dddddd;height:24px;}					.text-header{ font-size:12px;color:red;}				</style>			<fieldset style="border:1px solid #dddddd;margin-top:10px;">				<legend> Filter Premium Group </legend>				<div class="box-shadow">					<table witdh="100%" cellpadding="6px;">						<tr>							<td width="10%" class="text-header" nowrap> Product </td>							<td><?php $this -> JP_Plugin-> jpCombo('filter_product_id',NULL,$this -> getProduct(),NULL, 'onchange="getListFilterPlan(this);"');?></td>							<td id="edit_premium_group" rowspan="6" valign="top"></td>							</tr>						<tr>							<td class="text-header" nowrap> Group Premi </td>							<td><?php $this -> JP_Plugin-> jpCombo('filter_group_id',NULL,$this -> getListGroup(),NULL,NULL);?></td>						</tr>						<tr>							<td class="text-header" nowrap> Pay Mode</td>							<td><?php $this -> JP_Plugin-> jpCombo('filter_paymode_id',NULL,$this -> getListPaymode(),NULL,NULL);?></td>						</tr>						<tr>							<td class="text-header" nowrap> Plan </td>							<td id="html_cb_plan"> <?php $this -> JP_Plugin-> jpCombo('filter_plan_id',NULL,NULL,NULL,NULL);?></td>						</tr>												<tr>							<td class="text-header" nowrap> Age Band </td>							<td id="html_cb_age">								<select name="filter_age_id" id="filter_age_id">									<option> -- Choose --</option>								</select>								</td>						</tr>						<tr>							<td> </td>							<td> 							<a href="javascript:void(0);" class="sbutton" onclick="showEditPremium();" ><span>&nbsp;View</span></a>							 </td>						</tr>											</table>				</div>	</fieldset>			<?php					}		}		$ProductPlan = new ProductPlan();	$ProductPlan ->index();?>
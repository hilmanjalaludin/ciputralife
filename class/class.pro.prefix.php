<?php	require("../sisipan/sessions.php");	require("../fungsi/global.php");	require("../class/MYSQLConnect.php");	require("../plugin/lib.form.php");	/*	 *	class untuk action call result	 *  author : omens	 *  date : 2012-10-17	*/				class ProPrefix extends mysql{		var $action;		var $JP_Plugin;				function __construct()		{			parent::__construct();			$this -> action = $this->escPost('action');			$this -> JP_Plugin = new jpForm();					}			/* function set style css **/		function setCss(){?>						<!-- start: css -->				<style>					.select { border:1px solid #dddddd;font-size:11px;height:22px;background-color:#fffccc;}					.input_text {border:1px solid #dddddd;width:160px;font-size:12px;height:20px;background-color:#fffccc;}					.text_header { text-align:right;color:red;}					.select_multiple { border:1px solid #dddddd;width:250px;font-size:11px;background-color:#fffccc;}				</style>							<!-- stop: css -->		<?php }						function initClass(){			if( $this->havepost('action'))			{				switch( $this->action)				{					case 'tpl_add'  : $this->tplResultAdd();    break;					case 'tpl_edit' : $this->tplResultEdit();   break;					case 'tpl_delete': $this->tplResultRemove(); break;					case 'save_prefix': $this -> saveResult(); break;					case 'delete_result' : $this -> deleteResult(); break;					case 'enable_prefix' : $this -> enablePrefix(); break;					case 'disable_prefix' : $this -> disablePrefix(); break;						case 'get_tpl_form'	: $this -> getFormTpl(); break;						case 'save_tpl_form' : $this -> saveTplForm(); break;				}			}		}					/** updates form data product **/			function saveTplForm()		{			$array = array('result'=> 0);						$SQL_Update['FormLayout'] = $this -> escPost('FormProductId');			$SQL_Wheres['ProductId']  = $this -> escPost('ProductId');						if( $this -> set_mysql_update('t_gn_formlayout', $SQL_Update, $SQL_Wheres))			{				$array = array('result'=>1 );			}						echo json_encode($array);					}							/** updates form data product **/				function enablePrefix()		{			$sql = " update t_gn_productprefixnumber  set PrefixFlagStatus=1 					 where PrefixNumberId ='".$this -> escPost('resultid')."'"; 					 			$qry = $this ->execute($sql,__FILE__,__LINE__);						if ( $qry ) : echo 1;			else : 				echo 0; 			endif;		}			/** updates form data product **/				function disablePrefix()		{			$sql = " update t_gn_productprefixnumber  set PrefixFlagStatus=0					 where PrefixNumberId ='".$this -> escPost('resultid')."'"; 					 			$qry = $this ->execute($sql,__FILE__,__LINE__);						if ( $qry ) : echo 1;			else : 				echo 0; 			endif;		}					/* delete **/			function deleteResult()		{			$sql = " delete from t_gn_productprefixnumber where PrefixNumberId ='".$this -> escPost('resultid')."'"; 			$qry = $this ->execute($sql,__FILE__,__LINE__);						if ( $qry ) : echo 1;			else : 				echo 0; 			endif;		}		/** updates form data product **/			function genProductPrefix()		{			$number = '';			$maxLength  = $_REQUEST['prefix_prefix'];			$maxLength  = (($_REQUEST['prefix_prefix']) -strlen($_REQUEST['prefix_code']));			for( $i=1; $i<=$maxLength; $i++){				$number.='0';							}			return strtoupper($this -> escPost('prefix_code').trim($number));				}					/* save */				function saveResult()		{					$prefix = array(				'ProductId'=> $this -> escPost('prefix_head'), 				'PrefixChar'=> $this -> genProductPrefix(), 				'PrefixLength'=> $this -> escPost('prefix_name'), 				'PrefixFlagStatus'=> $this -> escPost('prefix_status')				);							$form = array(				'ProductId'=> $this -> escPost('prefix_head'), 				'FormLayout'=> NULL, 				'FormConds'=> 1				);									$query = $this -> set_mysql_insert('t_gn_productprefixnumber',$prefix);						if( $query ) : 				$query_form = $this -> set_mysql_insert('t_gn_formlayout',$form);				if( $query_form ) : echo 1;				else :					echo 0;				endif;			else :				echo 0;			endif;						}			/* get form php **/			function getFormLayout()		{			$dir_php = scandir(dirname(__FILE__)."/../php");			foreach($dir_php as $key => $filename )			{							if( file_exists(dirname(__FILE__)."/../php/".$filename) && $filename!='.' && $filename!='..')				{					$datas[$filename] = $filename;				}			}						return $datas;		}			/** function getCategory **/				private function getProduct()		{ 			$sql ="SELECT a.ProductId, a.ProductCode, a.ProductCode  from t_gn_product a where a.ProductStatusFlag=1";			$qry = $this -> query($sql);			foreach( $qry -> result_assoc() as $rows )			{				$datas[$rows['ProductId']]= $rows['ProductCode'];			}						return $datas;		}					/** function getCategory **/				private function getCategory()		{ 			return $status  = array(0=>'Not Active', 1=>'Active');		}				/** layoutv add product prefix ***/			function tplResultAdd(){ 				$this->setCss();		?>			<div id="result_content_add" class="box-shadow" style="margin-top:10px;">				<h3 class="box-shadow h3"> Add Product Prefix </h3>				<table cellpadding="6px;">					<tr>						<td class="text_header">* Product </td>						<td><?php $this -> JP_Plugin -> jpCombo('product_id','select',$this -> getProduct()); ?></td>					</tr>					<tr>						<td class="text_header">* Prefix Code</td>						<td>							<input type="text" name="result_code" id="result_code" class="input_text" style="padding-right:2px;width:90px;height:18px;text-align:left;" maxlength="10">						</td>					</tr>										<tr>						<td class="text_header">* Prefix Length</td>						<td>							<input type="text" name="result_name" id="result_name" class="input_text" style="width:90px;height:18px;text-align:left;"> 						</td>					</tr>										<tr>						<td class="text_header">Status</td>						<td><?php $this -> JP_Plugin -> jpCombo('status_active','select',$this ->getCategory()); ?></td>					</tr>										<tr>						<td class="text_header">&nbsp;</td>						<td><a href="javascript:void(0);" class="sbutton" onclick="savePrefix();"><span>&nbsp;Save</span></a></td>					</tr>				</table>			</div>		<?php		}			/** layoutv add product prefix ***/			function getFormTpl()		{			$this->setCss(); 						$sql = " SELECT c.ProductId, a.PrefixNumberId, b.ProductCode,  b.ProductName, a.PrefixChar, a.PrefixLength, c.FormLayout, IF( a.PrefixFlagStatus<>1, 'Not Active','Active') as Status					 FROM t_gn_productprefixnumber a					 LEFT JOIN t_gn_product b on a.ProductId=b.ProductId					 LEFT JOIN t_gn_formlayout c on b.ProductId=c.ProductId 					 WHERE a.PrefixNumberId='".$this -> escPost('prefix_id')."'";			 			$qry = $this -> query($sql);		 							?>			<div id="result_content_add" class="box-shadow" style="margin-top:10px;">				<h3 class="box-shadow h3"> Edit Form Product </h3>				<table cellpadding="6px;">					<tr>						<td class="text_header">* Product </td>						<td><?php $this -> JP_Plugin -> jpCombo('product_id','select',$this -> getProduct(), $qry -> result_get_value('ProductId'),NULL,1); ?></td>					</tr>					<tr style="display:none;">						<td class="text_header">* Currrent Form  </td>						<td><?php $this -> JP_Plugin -> jpCombo('current_form','select',$this -> getFormLayout(),$qry -> result_get_value('FormLayout'),NULL,1); ?></td>					</tr>										<tr>						<td class="text_header">* New Form </td>						<td><?php $this -> JP_Plugin -> jpCombo('new_form','select',$this -> getFormLayout(),NULL); ?></td>					</tr>					<tr>						<td class="text_header">&nbsp;</td>						<td><a href="javascript:void(0);" class="sbutton" onclick="saveForm();"><span>&nbsp;Save</span></a></td>					</tr>				</table>			</div>		<?php		}				/** layoutv rem product prefix ***/		function tplResultRemove(){ ?>			<div id="result_content_delete" class="box-shadow" style="margin-top:10px;">							</div>		<?php		}	}		$ProPrefix= new ProPrefix();	$ProPrefix -> initClass();
/*
 * @ def			: Axa Edit Product form js
 * @ revision		: 0.2 
 * @ package		: AXA Project Insured
 * @ created		: 2014-03-24
 * @ author			: anynoumous
 * update : 18-08-2015
 */
var sv="1",uw="2";Ext.DOM._benefieceryEdit={field:["EditBenefRelationshipTypeId","EditBenefSalutationId","EditBenefFirstName","EditBenefLastName","EditBenefGenderId","EditBenefPercentage"],chars:"Be",code:0},Ext.DOM._benefieceryAdd={field:["AddBenefRelationshipTypeId","AddBenefSalutationId","AddBenefFirstName","AddBenefLastName","AddBenefGenderId","AddBenefPercentage"],chars:"Be",code:0};var Mandat_SurveyQuest=[],Mandat_SurveyAns=[];Ext.DOM.Insured={field:{InsuredIdentificationTypeId:{keys:!1,warn:"ID Type",number:!1,clear:!0},InsuredIdentificationNum:{keys:!1,warn:"ID No ",number:!1,clear:!0},InsuredRelationshipTypeId:{keys:!1,warn:"Relation",number:!1,clear:!0},InsuredSalutationId:{keys:!1,warn:"Title",number:!1,clear:!0},InsuredFirstName:{keys:!1,warn:"First Name ",number:!1,clear:!0},InsuredLastName:{keys:!1,warn:"Last Name",number:!1,clear:!0},InsuredGenderId:{keys:!1,warn:"Gender",number:!1,clear:!0},InsuredDOB:{keys:!1,warn:"DOB",number:!1,clear:!0},InsuredAge:{keys:!1,warn:"Age",number:!0,clear:!0},InsuredPayMode:{keys:!1,warn:"Payment Mode",number:!1,clear:!1},InsuredPlanType:{keys:!1,warn:"Plan Type",number:!1,clear:!1},InsuredPremi:{keys:!1,warn:"Premi",number:!1,clear:!0}},chars:"Ho",code:2},Ext.DOM.Payer={PayerSalutationId:{keys:!1,warn:"ID Type",number:!1,clear:!0},PayerFirstName:{keys:!1,warn:"ID Type",number:!1,clear:!0},PayerLastName:{keys:!1,warn:"ID Type",number:!1,clear:!0},PayerGenderId:{keys:!1,warn:"ID Type",number:!1,clear:!0},PayerDOB:{keys:!1,warn:"ID Type",number:!1,clear:!0},PayerAddressLine1:{keys:!1,warn:"ID Type",number:!1,clear:!0},PayerIdentificationTypeId:{keys:!1,warn:"ID Type",number:!1,clear:!0},PayerIdentificationNum:{keys:!1,warn:"ID Type",number:!1,clear:!0},PayerMobilePhoneNum:{keys:!1,warn:"ID Type",number:!1,clear:!0},PayerCity:{keys:!1,warn:"ID Type",number:!1,clear:!0},PayerAddressLine2:{keys:!1,warn:"ID Type",number:!1,clear:!0},PayerHomePhoneNum:{keys:!1,warn:"ID Type",number:!1,clear:!0},PayerZipCode:{keys:!1,warn:"ID Type",number:!1,clear:!0},PayerAddressLine3:{keys:!1,warn:"ID Type",number:!1,clear:!0},PayerOfficePhoneNum:{keys:!1,warn:"ID Type",number:!1,clear:!0},PayerProvinceId:{keys:!1,warn:"ID Type",number:!1,clear:!0},PayerAddressLine4:{keys:!1,warn:"ID Type",number:!1,clear:!0},PayerCreditCardNum:{keys:!1,warn:"ID Type",number:!1,clear:!0},PayersBankId:{keys:!1,warn:"ID Type",number:!1,clear:!0},PayerFaxNum:{keys:!1,warn:"ID Type",number:!1,clear:!0},PayerCreditCardExpDate:{keys:!1,warn:"ID Type",number:!1,clear:!0},CreditCardTypeId:{keys:!1,warn:"ID Type",number:!1,clear:!0},PayerEmail:{keys:!1,warn:"ID Type",number:!1,clear:!0}},Ext.DOM.FormBenefieceryEdit=function(e,t){if(e.checked)for(var r in Ext.DOM._benefieceryEdit.field)Ext.Cmp(Ext.DOM._benefieceryEdit.field[r]+"_"+t).disabled(!1);else for(var r in Ext.DOM._benefieceryEdit.field)Ext.Cmp(Ext.DOM._benefieceryEdit.field[r]+"_"+t).disabled(!0),Ext.Cmp(Ext.DOM._benefieceryEdit.field[2]+"_"+t).empty()&&Ext.Cmp(Ext.DOM._benefieceryEdit.field[r]+"_"+t).setValue("")},Ext.DOM.FormBenefieceryAdd=function(e,t){if(e.checked)for(var r in Ext.DOM._benefieceryAdd.field)Ext.Cmp(Ext.DOM._benefieceryAdd.field[r]+"_"+t).disabled(!1);else for(var r in Ext.DOM._benefieceryAdd.field)Ext.Cmp(Ext.DOM._benefieceryAdd.field[r]+"_"+t).disabled(!0),Ext.Cmp(Ext.DOM._benefieceryAdd.field[2]+"_"+t).empty()&&Ext.Cmp(Ext.DOM._benefieceryAdd.field[r]+"_"+t).setValue("");Ext.DOM.PercentageAdd()},Ext.DOM.PercentageAdd=function(){for(var e=Ext.Cmp("AddBenefeciery").getName(),t=0,r=100,a=0,n=0;n<e.length;n++)e[n].checked&&a++;t=parseInt(r)/parseInt(a);for(var d=0;d<e.length;d++)if(e[d].checked){var s=e[d].getAttribute("onclick").split(",")[1].replace(/\);/g,"");Ext.Cmp("AddBenefPercentage_"+s).setValue(t.toFixed(2))}},Ext.DOM.getPremi=function(){if(Ext.Cmp("ProductId").empty())return Ext.Msg("Product ID is Empty").Info(),!1;if(Ext.Cmp("InsuredGroupPremi").empty())return Ext.Msg("Group Premi is Empty").Info(),!1;if(Ext.Cmp("InsuredAge").empty())return Ext.Msg("Age is Empty").Info(),!1;if(0==Ext.Cmp("InsuredAge").getValue())return Ext.Msg("Age is Zero").Info(),!1;if(Ext.Cmp("InsuredPayMode").empty())return Ext.Msg("Payment Mode").Info(),!1;if(Ext.Cmp("InsuredPlanType").empty())return Ext.Msg("Product Plan").Info(),!1;var e=Ext.Ajax({url:"../class/class.SaveAxa.php",method:"GET",param:{action:"_get_premi",PlanTypeId:Ext.Cmp("InsuredPlanType").getValue(),PersonalAge:Ext.Cmp("InsuredAge").getValue(),PayModeId:Ext.Cmp("InsuredPayMode").getValue(),ProductId:Ext.Cmp("ProductId").getValue(),GroupPremi:Ext.Cmp("InsuredGroupPremi").getValue()}}).json();Ext.Cmp("InsuredPremi").setValue(e.personal_premi),Ext.Cmp("InsuredPremi").disabled(!0)},Ext.DOM.OnUnloadWindow=function(){window.opener&&window.opener.Transaction()},Ext.DOM.CloseSelfWindow=function(e){window.opener&&(window.opener.Transaction(),window.close(e))},Ext.DOM.ExtInsured=function(){var e=[];e.action="_set_update_insured",e.InsuredId=Ext.Cmp("InsuredId").getValue(),e.CustomerId=Ext.Cmp("CustomerId").getValue(),e.ProductId=Ext.Cmp("ProductId").getValue(),Ext.Ajax({url:"../class/class.EditAxa.php",method:"POST",param:Ext.Join(new Array(e,Ext.Serialize("form_edit_insured").getElement())).object(),ERROR:function(e){var t=JSON.parse(e.target.responseText);t.success?(Ext.Msg("Update Insured ").Success(),Ext.DOM.CloseSelfWindow("WinEditInsured")):Ext.Msg("Update Insured ").Failed()}}).post()},Ext.DOM.ExtAddBenefiecery=function(){var e=[];e.Add=Ext.Cmp("AddBenefeciery").getValue(),e.action="_set_add_benefiecery",e.InsuredId=Ext.Cmp("InsuredId").getValue(),e.CustomerId=Ext.Cmp("CustomerId").getValue(),Ext.Ajax({url:"../class/class.EditAxa.php",method:"POST",param:Ext.Join(new Array(e,Ext.Cmp("AddBenefeciery").getChecked()?Ext.Serialize("form_add_benefiecery").getElement():new Array)).object(),ERROR:function(e){var t=JSON.parse(e.target.responseText);t.success?(Ext.Msg("Add Benefiecery").Success(),Ext.DOM.CloseSelfWindow("WinEditInsured")):Ext.Msg("Add Benefiecery ").Failed()}}).post()},Ext.DOM.ExtUpdateBenefiecery=function(){var e=[];e.action="_set_update_benefiecery",e.Edit=Ext.Cmp("EditBenefeciery").getValue(),e.InsuredId=Ext.Cmp("InsuredId").getValue(),e.CustomerId=Ext.Cmp("CustomerId").getValue(),Ext.Ajax({url:"../class/class.EditAxa.php",method:"POST",param:Ext.Join(new Array(e,Ext.Cmp("EditBenefeciery").getChecked()?Ext.Serialize("form_edit_benefiecery").getElement():new Array)).object(),ERROR:function(e){var t=JSON.parse(e.target.responseText);t.success?(Ext.Msg("Update Benefiecery").Success(),Ext.DOM.CloseSelfWindow("WinEditInsured")):Ext.Msg("Update Benefiecery").Failed()}}).post()},Ext.DOM.UpdatePayer=function(){var e=[];e.action="_set_update_payers",e.CustomerId=Ext.Cmp("CustomerId").getValue(),Ext.Ajax({url:"../class/class.EditAxa.php",method:"POST",param:Ext.Join([e,Ext.Serialize("form_edit_payers").getElement()]).object(),ERROR:function(e){var t=JSON.parse(e.target.responseText);t.success?(Ext.Msg("Update Payer").Success(),Ext.DOM.CloseSelfWindow("WinEditInsured")):Ext.Msg("Update Payer").Failed()}}).post()},Ext.DOM.UpdateSurvey=function(){if(Ext.DOM.ValidSurvey())return alert("Please answer survey (red box area)"),!1;var e=[];e.action="_set_update_survey",e.CustomerId=Ext.Cmp("CustomerId").getValue(),e.ProductId=Ext.Cmp("ProductId").getValue(),e.questioner_type=sv,Ext.Ajax({url:"../class/class.EditAxa.php",method:"POST",param:Ext.Join([e,Ext.Serialize("form_edit_survey").getElement()]).object(),ERROR:function(e){var t=JSON.parse(e.target.responseText);t.success?(Ext.Msg("Update Survey").Success(),Ext.DOM.CloseSelfWindow("WinEditSurvey")):Ext.Msg("Update Survey").Failed()}}).post()},Ext.DOM.ValidSurvey=function(){var e=0;for(var t in Mandat_SurveyQuest)if("undefined"==typeof Mandat_SurveyAns[t])""==Ext.Cmp("survey_"+Mandat_SurveyQuest[t]).getValue()?($("#ans_valid_"+Mandat_SurveyQuest[t]).css({border:"2px solid #FF0000"}),e++):$("#ans_valid_"+Mandat_SurveyQuest[t]).css({border:"0px solid #000000"});else{var r="";for(var a in Mandat_SurveyAns[t])r+=Ext.Cmp("survey_"+Mandat_SurveyQuest[t]+"_"+Mandat_SurveyAns[t][a]).getValue();""==r?($("#ans_valid_"+Mandat_SurveyQuest[t]).css({border:"2px solid #FF0000"}),e++):$("#ans_valid_"+Mandat_SurveyQuest[t]).css({border:"0px solid #000000"})}return e>0?!0:!1},Ext.DOM.ValidRule=function(){var e=!1,t=(new Array,Ext.Ajax({url:"../class/class.SaveAxa.php",method:"GET",param:{action:"_getValidAnswer",ProductId:Ext.Cmp("ProductId").getValue()}}).json()),r=Ext.Ajax({url:"../class/class.SaveAxa.php",method:"GET",param:{action:"_getExceptQuestion",ProductId:Ext.Cmp("ProductId").getValue()}}).json();for(var a in t.question){var n=t.answer[a],d=Ext.Cmp("survey_"+a).getValue();if(1==d.length){var s=String(d);if(-1==n.indexOf(s)){if("undefined"==typeof r[a]){e=!0;break}var i=Ext.Cmp("survey_"+r[a]).getValue();if(!(i.length>0)){e=!0;break}var u=t.answer[r[a]];for(var o in i){if(-1==u.indexOf(String(i[o]))){e=!0;break}e=!1}}else e=!1}else for(var l in d){if(-1==n.indexOf(String(d[l]))){e=!0;break}e=!1}}return e},Ext.DOM.UWEmpty=function(){var e=!1,t=Ext.Ajax({url:"../class/class.SaveAxa.php",method:"GET",param:{action:"_getUWQuestion",ProductId:Ext.Cmp("ProductId").getValue()}}).json();for(var r in t){if(!Ext.Cmp("survey_"+r).empty()){e=!1;break}e=!0}return e},Ext.DOM.UpdateUW=function(){if(Ext.DOM.ValidSurvey())return alert("Please answer underwriting (red box area)"),!1;if(Ext.DOM.ValidRule())return alert("Rule is not Valid, please reject/cancel this policy !"),!1;if(Ext.DOM.UWEmpty())return alert("Underwriting is empty"),!1;var e=[];e.action="_set_update_survey",e.CustomerId=Ext.Cmp("CustomerId").getValue(),e.ProductId=Ext.Cmp("ProductId").getValue(),e.InsuredId=Ext.Cmp("InsuredId").getValue(),e.questioner_type=uw,Ext.Ajax({url:"../class/class.EditAxa.php",method:"POST",param:Ext.Join([e,Ext.Serialize("form_edit_uw").getElement()]).object(),ERROR:function(e){var t=JSON.parse(e.target.responseText);t.success?(Ext.Msg("Update Underwriting").Success(),Ext.DOM.CloseSelfWindow("WinEditSurvey")):Ext.Msg("Update Underwriting").Failed()}}).post()},Ext.DOM.is_valid_payer=function(){},Ext.DOM.UpdateStatusIns=function(){var e=Ext.Cmp("StatusInsured").getValue(),t=Ext.Cmp("InsuredId").getValue();if(!e)return alert("Please choose status!"),!1;var r=Ext.Ajax({url:"../class/class.SaveAxa.php",method:"GET",param:{action:"_update_qc",StatusId:e,InsuredId:t}}).json();return r.result?(alert("Update status QC, success!"),void Ext.DOM.OnUnloadWindow()):(alert("Update status QC, failed!"),!1)},$(document).ready(function(){Mandat_SurveyQuest=Ext.Ajax({url:"../class/class.SaveAxa.php",method:"GET",param:{action:"_get_mandat_quest",ProductId:Ext.Cmp("ProductId").getValue()}}).json(),Mandat_SurveyAns=Ext.Ajax({url:"../class/class.SaveAxa.php",method:"GET",param:{action:"_get_mandat_ans",ProductId:Ext.Cmp("ProductId").getValue()}}).json(),$("#tabs").tabs(),$("#tabs ul").tabs().append('<li onclick="javascript:CloseSelfWindow(\'WinEditInsured\');" style="margin-top:2px;cursor:pointer;border:0px solid #ffffff;padding:1px;float:right;margin-right:10px;" title="Exit"><img src="../gambar/icon/cancel.png"></li>');var e=parseInt($(window).height()-150);e&&($("#tabs-2").css({height:e+"px",overflow:"auto"}),$("#tabs-5").css({height:e+"px",overflow:"auto"}),$("#tabs-6").css({height:e+"px",overflow:"auto"}),$("#tabs-7").css({height:e+"px",overflow:"auto"}),$("#tabs-9").css({height:e+"px",overflow:"auto"}),$("#tabs-10").css({height:e+"px",overflow:"auto"})),$(".date").datepicker({buttonImage:"../gambar/calendar.gif",buttonImageOnly:!0,changeMonth:!0,changeYear:!0,yearRange:"1945:2030",dateFormat:"dd-mm-yy",onSelect:function(e){var t=$(this).attr("id"),r=t.substring(0,2),a=e.split("-"),n=a[2]+"-"+a[1]+"-"+a[0];if(a.length>2&&"Ad"!=r&&"Ed"!=r){var d=Ext.Ajax({url:"../class/class.SaveAxa.php",method:"GET",param:{action:"_get_age",ProductId:Ext.Cmp("ProductId").getValue(),GroupPremi:Ext.Cmp("InsuredGroupPremi").getValue(),DOB:n.trim()}}).json();d.success?(Ext.Cmp("InsuredAge").setValue(d.personal_age),Ext.Cmp("InsuredPremi").setValue(Ext.Ajax({url:"../class/class.SaveAxa.php",method:"GET",param:{action:"_get_premi",ProductId:Ext.Cmp("ProductId").getValue(),PersonalAge:Ext.Cmp("InsuredAge").getValue(),PayModeId:Ext.Cmp("InsuredPayMode").getValue(),PlanTypeId:Ext.Cmp("InsuredPlanType").getValue(),GroupPremi:Ext.Cmp("InsuredGroupPremi").getValue()}}).json().personal_premi)):(Ext.Msg(d.Error).Error(),Ext.Cmp("InsuredAge").setValue(""),Ext.Cmp("InsuredPremi").setValue("")),Ext.Cmp("InsuredAge").disabled(!0),Ext.Cmp("InsuredPremi").disabled(!1)}}})});